<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="M2 Installer Studio - Design custom deployment plans, generate Docker Compose, and export .env files for your media stack." />
    <meta name="theme-color" content="#38bdf8" />
    <meta name="color-scheme" content="dark" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <title>M2 Installer Studio</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="hero">
      <div>
        <p class="eyebrow">Media + AI Apps + Zero Trust</p>
        <h1>M2 Installer Studio</h1>
        <p class="lede">
          Design a custom deployment plan, generate Docker Compose, and export
          an <code>.env</code> tailored to your stack.
        </p>
        <div class="hero-actions">
          <button class="btn-primary btn-large" id="startWizard">
            üöÄ Start Easy Setup Wizard
          </button>
          <button class="btn-ghost btn-large" id="advancedMode">
            ‚öôÔ∏è Advanced Configuration
          </button>
        </div>
      </div>
      <div class="header-controls">
        <div class="theme-selector">
          <label for="themeSelector" class="eyebrow">Theme</label>
          <select id="themeSelector" class="theme-select">
            <option value="dark">Dark</option>
            <option value="midnight">Midnight</option>
            <option value="ocean">Ocean</option>
            <option value="forest">Forest</option>
            <option value="cyberpunk">Cyberpunk</option>
          </select>
        </div>
        <div id="progressRingMount" class="progress-ring-mount" aria-label="Setup progress tracker"></div>
        <div class="pill" role="status" aria-live="polite">Updated for 2025 best practices</div>
      </div>
    </header>

    <main class="layout">
      <aside class="sidebar" aria-label="Navigation and guidance">
        <section class="sidebar-section">
          <h2 class="eyebrow">Flow</h2>
          <ol id="stepList" class="step-list" role="list" aria-label="Setup steps">
            <li data-step="0" class="active" role="listitem"><button type="button" aria-current="step">Profile</button></li>
            <li data-step="1" role="listitem"><button type="button">File type coverage</button></li>
            <li data-step="2" role="listitem"><button type="button">Pick your stack</button></li>
            <li data-step="3" role="listitem"><button type="button">Access & identity</button></li>
            <li data-step="4" role="listitem"><button type="button">Build the .env</button></li>
            <li data-step="5" role="listitem"><button type="button">Compose output</button></li>
            <li data-step="6" role="listitem"><button type="button">Runbook</button></li>
          </ol>
        </section>
        <section class="sidebar-section">
          <h2 class="eyebrow">Guidance</h2>
          <ul class="sidebar-tips">
            <li>Save often: use download buttons after finishing each step.</li>
            <li>GPU hint toggles VAAPI/NVENC entries for Jellyfin.</li>
            <li>
              Cloudflare Tunnel and Object Storage toggles mirror the catalog
              selections.
            </li>
          </ul>
        </section>
      </aside>

      <div class="content" role="main">
        <section class="card step-panel active" data-step="0" id="profile" aria-labelledby="profile-heading">
          <div class="card-header">
            <div>
              <p class="eyebrow">Step 1</p>
              <h2 id="profile-heading">Project profile</h2>
              <p>
                Capture the core details that drive hostnames, storage, and
                secrets.
              </p>
            </div>
            <div class="actions">
              <button id="loadSample" class="primary" type="button">Load sample stack</button>
              <button id="autoFill" class="ghost" type="button">Auto-fill safe defaults</button>
            </div>
          </div>
          <div class="grid two-col">
            <label class="field" data-insight="Keep the Compose slug short so container names stay readable ‚Äì a recurring Nov 25, 2024 /r/selfhosted tip.">
              <span>Project name</span>
              <input type="text" id="projectName" placeholder="m2-stack" />
              <small>Used for <code>COMPOSE_PROJECT_NAME</code>.</small>
            </label>
            <label class="field" data-insight="Cloudflare community posts around Nov 25, 2024 recommend dedicating a subdomain per stack for cleaner Access policies.">
              <span>Base domain</span>
              <input
                type="text"
                id="baseDomain"
                placeholder="media.example.com"
              />
              <small>Applies to Cloudflare/Access + app hostnames.</small>
            </label>
            <label class="field" data-insight="Jellyfin and Immich release threads (Nov 2024) stressed matching the host timezone to keep cron, logs, and hardware acceleration aligned.">
              <span>Timezone</span>
              <input type="text" id="timezone" placeholder="UTC" />
              <small>Used by containers to align cron and logging.</small>
            </label>
            <label class="field" data-insight="DataHoarder polls on Nov 25, 2024 showed most homelabbers mounting libraries at /srv/media-style paths to standardize across containers.">
              <span>Media storage path</span>
              <input type="text" id="mediaPath" placeholder="/srv/media" />
              <small>Mounted into Jellyfin/Sonarr/Radarr/qBittorrent.</small>
            </label>
            <label class="field" data-insight="Homelab Discord moderators (Nov 2024) recommend isolating config/data paths on SSD or ZFS datasets like /srv/m2-data for quick restore drills.">
              <span>Data/config path</span>
              <input type="text" id="dataPath" placeholder="/srv/m2-data" />
              <small>Holds app configs, databases, and Prometheus rules.</small>
            </label>
          </div>
          <div class="panel-nav">
            <span></span>
            <button class="primary" data-next>Next: File types</button>
          </div>
        </section>

        <section class="card step-panel" data-step="1" id="coverage">
          <div class="card-header">
            <div>
              <p class="eyebrow">Step 2</p>
              <h2>File type coverage</h2>
              <p>
                Select the media you need to support. We will highlight apps
                that cover each family.
              </p>
            </div>
          </div>
          <div id="fileTypeGuide" class="filetype-grid"></div>
          <div id="coverageSummary" class="coverage-summary"></div>
          <div class="panel-nav">
            <button class="ghost" data-prev>Back</button>
            <button class="primary" data-next>Next: Stack</button>
          </div>
        </section>

        <section class="card step-panel" data-step="2" id="stack">
          <div class="card-header">
            <div>
              <p class="eyebrow">Step 3</p>
              <h2>Choose your stack</h2>
              <p>
                Mix and match services; the generator will wire them together.
              </p>
            </div>
            <div class="stack-toggles">
              <label class="toggle">
                <input type="checkbox" id="gpuAcceleration" />
                <span>Enable GPU hints (VAAPI/NVENC)</span>
              </label>
              <label class="toggle" data-insight="Cloudflare‚Äôs Nov 25, 2024 Zero Trust digest reaffirms tunnels plus Access policies as the default perimeter for homelab apps.">
                <input type="checkbox" id="cloudflareTunnel" />
                <span>Include Cloudflare Tunnel</span>
              </label>
              <label class="toggle" data-insight="Popular /r/DataHoarder threads (Nov 2024) pair MinIO/S3 buckets with media stacks for off-site replicas.">
                <input type="checkbox" id="objectStorage" />
                <span>Use S3/MinIO for assets</span>
              </label>
            </div>
          </div>

          <div id="templateGallery" aria-live="polite"></div>
          <div class="catalog" id="serviceCatalog"></div>
          <div class="panel-nav">
            <button class="ghost" data-prev>Back</button>
            <button class="primary" data-next>Next: Access</button>
          </div>
        </section>

        <section class="card step-panel" data-step="3" id="auth">
          <div class="card-header">
            <div>
              <p class="eyebrow">Step 4</p>
              <h2>Access & identity</h2>
              <p>Select your auth gateway and tunnel preference.</p>
            </div>
          </div>
          <div class="grid three-col">
            <label class="field select" data-insight="Authelia, Authentik, and OAuth2 Proxy each handle social logins; Cloudflare + IdP pairings discussed on Nov 25, 2024 Mastodon threads favor these three combos.">
              <span>Auth gateway</span>
              <select id="authChoice">
                <option value="authelia">Authelia</option>
                <option value="authentik">Authentik</option>
                <option value="oauth2-proxy">OAuth2 Proxy</option>
              </select>
              <small
                >All options sit in front of the apps and support social login
                flows.</small
              >
            </label>
            <label class="toggle inline" data-insight="Cloudflare Zero Trust‚Äôs November 2024 update made tunnels the safest remote entry over raw port forwarding.">
              <input type="checkbox" id="cloudflareTunnelInline" />
              <span>Include Cloudflare Tunnel</span>
            </label>
            <label class="toggle inline" data-insight="Fediverse storage chats on Nov 25, 2024 highlighted object stores (Wasabi/MinIO) as the go-to for backups and AI workloads.">
              <input type="checkbox" id="objectStorageInline" />
              <span>Use S3/MinIO for assets</span>
            </label>
          </div>
          <div class="panel-nav">
            <button class="ghost" data-prev>Back</button>
            <button class="primary" data-next>Next: .env</button>
          </div>
        </section>

        <section class="card step-panel" data-step="4" id="env">
          <div class="card-header">
            <div>
              <p class="eyebrow">Step 5</p>
              <h2>.env builder</h2>
              <p>
                Provide secrets and tune defaults. Required values are marked.
              </p>
            </div>
            <div class="actions">
              <button id="copyEnv" class="ghost">Copy .env</button>
              <button id="downloadEnv" class="primary">Download .env</button>
            </div>
          </div>
          <div class="callout">
            <strong>Integration tip:</strong> the shared API key defaults to
            <code>m2-shared-token</code> and can be reused by Overseerr,
            Prowlarr, and your automation scripts when connecting services.
          </div>
          <section class="user-vars card-subsection" aria-labelledby="userVarsHeading">
            <div class="user-vars-head">
              <div>
                <p class="eyebrow">Saved inputs</p>
                <h3 id="userVarsHeading">User variable storage</h3>
                <p>Keep API tokens or hostnames handy, then reuse them in the .env or even inside the compose YAML.</p>
              </div>
              <div class="user-vars-actions">
                <label class="sr-only" for="userVarSelect">Saved variables</label>
                <select id="userVarSelect" class="user-var-select">
                  <option value="">Select saved variable‚Ä¶</option>
                </select>
                <button id="applyUserVar" class="ghost" type="button">Insert into .env</button>
                <button id="toggleUserVarForm" class="primary" type="button">Add variable</button>
              </div>
              <p class="muted">Tip: click into any .env field first, then use the dropdown to drop in a saved value.</p>
            </div>
            <form id="userVarForm" class="user-var-form" hidden>
              <div class="grid two-col">
                <label class="field">
                  <span>Label</span>
                  <input type="text" id="userVarLabel" placeholder="Cloudflare API token" />
                </label>
                <label class="field">
                  <span>Key</span>
                  <input type="text" id="userVarKey" placeholder="CF_API_TOKEN" />
                </label>
              </div>
              <label class="field">
                <span>Value</span>
                <textarea id="userVarValue" rows="2" placeholder="Copy the secret or slug here"></textarea>
              </label>
              <label class="field">
                <span>Description</span>
                <textarea id="userVarDescription" rows="2" placeholder="Where this variable is used"></textarea>
              </label>
              <div class="user-var-switches">
                <label class="toggle inline">
                  <input type="checkbox" id="userVarEnv" checked />
                  <span>Include in .env</span>
                </label>
                <label class="toggle inline">
                  <input type="checkbox" id="userVarCompose" />
                  <span>Expose under compose x-user-vars</span>
                </label>
              </div>
              <div class="user-var-form-actions">
                <button type="button" class="ghost" id="cancelUserVar">Cancel</button>
                <button type="submit" class="primary">Save variable</button>
              </div>
            </form>
            <div id="userVarList" class="user-var-list" aria-live="polite"></div>
          </section>
          <section class="card-subsection" id="variableRunbook" aria-labelledby="variableRunbookHeading">
            <div class="runbook-head">
              <div>
                <p class="eyebrow">Runbook</p>
                <h3 id="variableRunbookHeading">Per-service variable notes</h3>
                <p>Capture why each container is configured the way it is. These notes are included in a Markdown runbook you can keep next to your compose files.</p>
              </div>
              <button id="downloadRunbook" class="primary" type="button">Download variable runbook (.md)</button>
            </div>
            <div id="serviceRunbook" class="service-runbook" aria-live="polite"></div>
          </section>
          <div id="envForm" class="env-form"></div>
          <pre id="envPreview" class="preview"></pre>
          <div class="panel-nav">
            <button class="ghost" data-prev>Back</button>
            <button class="primary" data-next>Next: Compose</button>
          </div>
        </section>

        <section class="card step-panel" data-step="5" id="compose">
          <div class="card-header">
            <div>
              <p class="eyebrow">Step 6</p>
              <h2>Docker Compose</h2>
              <p>
                Generated from your selections with network and healthcheck
                defaults.
              </p>
            </div>
            <div class="actions">
              <button id="copyCompose" class="ghost">Copy YAML</button>
              <button id="downloadCompose" class="primary">
                Download compose.yml
              </button>
            </div>
          </div>
          <pre id="composePreview" class="preview"></pre>
          <div class="panel-nav">
            <button class="ghost" data-prev>Back</button>
            <button class="primary" data-next>Next: Runbook</button>
          </div>
        </section>

        <section class="card step-panel" data-step="6" id="runbook">
          <div class="card-header">
            <div>
              <p class="eyebrow">Step 7</p>
              <h2>Runbook</h2>
              <p>Use these commands locally after saving the files.</p>
            </div>
          </div>
          <ol class="runbook">
            <li>Create the files: <code>touch .env compose.yml</code></li>
            <li>Paste or download the generated content above.</li>
            <li>Validate: <code>docker compose config</code></li>
            <li>Start: <code>docker compose up -d</code></li>
            <li>Inspect health: <code>docker compose ps</code></li>
          </ol>
          <div class="panel-nav">
            <button class="ghost" data-prev>Back</button>
            <span></span>
          </div>
        </section>
      </div>
    </main>

    <footer class="footer">
      <p>
        Built for self-hosters who want a flexible, Zero Trust-ready media
        cloud.
      </p>
    </footer>

    <script src="app.js"></script>
  </body>
</html>
